!function e(t,i,n){function s(a,o){if(!i[a]){if(!t[a]){var h="function"==typeof require&&require;if(!o&&h)return h(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[a]={exports:{}};t[a][0].call(d.exports,function(e){var i=t[a][1][e];return s(i?i:e)},d,d.exports,e,t,i,n)}return i[a].exports}for(var r="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(e,t,i){(function(t){"use strict";var i=e("./index");t.Lunicorn=i.Lunicorn}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./index":3}],2:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?"lunicorn_flash":arguments[0];n(this,e),this.container=this.createContainer(t)}return s(e,[{key:"addFlash",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?7e3:arguments[2],n=new a(e,t);return this.container.appendChild(n.el),n.scrollTo(),setTimeout(n.remove.bind(n),i),n}},{key:"createContainer",value:function(e){var t=document.createElement("div");return t.id=e,document.body.insertBefore(t,document.body.childNodes[0]),t}}]),e}(),a=function(){function e(t,i){n(this,e),this.el=this.createElement(t),this.message=this.sanitizeMessage(i),this.el.appendChild(this.message)}return s(e,[{key:"sanitizeMessage",value:function(e){return document.createTextNode(e)}},{key:"createElement",value:function(e){var t=document.createElement("div");return t.className=e,t}},{key:"scrollTo",value:function(){window.scrollTo(0,0)}},{key:"remove",value:function(){console.log("wats"),this.el.remove()}}]),e}();i.FlashFactory=r},{}],3:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.Lunicorn=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=e("./flash_factory"),o=e("pym.js"),h=n(o),Lunicorn=function(){function Lunicorn(e){s(this,Lunicorn),this.iframeCrosser=e}return r(Lunicorn,[{key:"sendMessage",value:function(e,t){t=t||{},this.iframeCrosser.sendMessage(e,JSON.stringify(t))}},{key:"addHandler",value:function(e,t){this.iframeCrosser.onMessage(e,function(e){t(JSON.parse(e))})}},{key:"addFlashHandler",value:function(){var e=this;this.addHandler("flash",function(t){console.log(t);var i=void 0;for(i in t)e.addFlash(i,t[i])})}},{key:"addFlash",value:function(e,t){return this._flashFactory=this._flashFactory||new a.FlashFactory,this._flashFactory.addFlash(e,t)}}],[{key:"createIframe",value:function(e,t){var i=new this(new h["default"].Parent(e,t,{}));return i.addFlashHandler(),i}},{key:"consumeIframe",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=new h["default"].Child(e);return t.sendHeight(),new this(t)}}]),Lunicorn}();i.Lunicorn=Lunicorn},{"./flash_factory":2,"pym.js":4}],4:[function(e,t,i){!function(e){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof t&&t.exports?t.exports=e():window.pym=e.call(this)}(function(){var e="xPYMx",t={},i=function(e){var t=new RegExp("[\\?&]"+e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)"),i=t.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},n=function(e,t){return"*"===t.xdomain||e.origin.match(new RegExp(t.xdomain+"$"))?!0:void 0},s=function(t,i,n){var s=["pym",t,i,n];return s.join(e)},r=function(t){var i=["pym",t,"(\\S+)","(.+)"];return new RegExp("^"+i.join(e)+"$")},a=function(){for(var e=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),i=e.length,n=0;i>n;++n){var s=e[n];s.setAttribute("data-pym-auto-initialized",""),""===s.id&&(s.id="pym-"+n);var r=s.getAttribute("data-pym-src"),a=s.getAttribute("data-pym-xdomain"),o={};a&&(o.xdomain=a),new t.Parent(s.id,r,o)}};return t.Parent=function(e,t,i){this.id=e,this.url=t,this.el=document.getElementById(e),this.iframe=null,this.settings={xdomain:"*"},this.messageRegex=r(this.id),this.messageHandlers={},i=i||{},this._constructIframe=function(){var e=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var t="",i=this.url.indexOf("#");i>-1&&(t=this.url.substring(i,this.url.length),this.url=this.url.substring(0,i)),this.url.indexOf("?")<0?this.url+="?":this.url+="&",this.iframe.src=this.url+"initialWidth="+e+"&childId="+this.id+"&parentUrl="+encodeURIComponent(window.location.href)+t,this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.el.appendChild(this.iframe),window.addEventListener("resize",this._onResize)},this._onResize=function(){this.sendWidth()}.bind(this),this._fire=function(e,t){if(e in this.messageHandlers)for(var i=0;i<this.messageHandlers[e].length;i++)this.messageHandlers[e][i].call(this,t)},this.remove=function(){window.removeEventListener("message",this._processMessage),window.removeEventListener("resize",this._onResize),this.el.removeChild(this.iframe)},this._processMessage=function(e){if(n(e,this.settings)&&"string"==typeof e.data){var t=e.data.match(this.messageRegex);if(!t||3!==t.length)return!1;var i=t[1],s=t[2];this._fire(i,s)}}.bind(this),this._onHeightMessage=function(e){var t=parseInt(e);this.iframe.setAttribute("height",t+"px")},this._onNavigateToMessage=function(e){document.location.href=e},this.onMessage=function(e,t){e in this.messageHandlers||(this.messageHandlers[e]=[]),this.messageHandlers[e].push(t)},this.sendMessage=function(e,t){this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(s(this.id,e,t),"*")},this.sendWidth=function(){var e=this.el.offsetWidth.toString();this.sendMessage("width",e)};for(var a in i)this.settings[a]=i[a];return this.onMessage("height",this._onHeightMessage),this.onMessage("navigateTo",this._onNavigateToMessage),window.addEventListener("message",this._processMessage,!1),this._constructIframe(),this},t.Child=function(t){this.parentWidth=null,this.id=null,this.parentUrl=null,this.settings={renderCallback:null,xdomain:"*",polling:0},this.messageRegex=null,this.messageHandlers={},t=t||{},this.onMessage=function(e,t){e in this.messageHandlers||(this.messageHandlers[e]=[]),this.messageHandlers[e].push(t)},this._fire=function(e,t){if(e in this.messageHandlers)for(var i=0;i<this.messageHandlers[e].length;i++)this.messageHandlers[e][i].call(this,t)},this._processMessage=function(e){if(n(e,this.settings)&&"string"==typeof e.data){var t=e.data.match(this.messageRegex);if(t&&3===t.length){var i=t[1],s=t[2];this._fire(i,s)}}}.bind(this),this._onWidthMessage=function(e){var t=parseInt(e);t!==this.parentWidth&&(this.parentWidth=t,this.settings.renderCallback&&this.settings.renderCallback(t),this.sendHeight())},this.sendMessage=function(e,t){window.parent.postMessage(s(this.id,e,t),"*")},this.sendHeight=function(){var e=document.getElementsByTagName("body")[0].offsetHeight.toString();this.sendMessage("height",e)}.bind(this),this.scrollParentTo=function(e){this.sendMessage("navigateTo","#"+e)},this.navigateParentTo=function(e){this.sendMessage("navigateTo",e)},this.id=i("childId")||t.id,this.messageRegex=new RegExp("^pym"+e+this.id+e+"(\\S+)"+e+"(.+)$");var r=parseInt(i("initialWidth"));this.parentUrl=i("parentUrl"),this.onMessage("width",this._onWidthMessage);for(var a in t)this.settings[a]=t[a];return window.addEventListener("message",this._processMessage,!1),this.settings.renderCallback&&this.settings.renderCallback(r),this.sendHeight(),this.settings.polling&&window.setInterval(this.sendHeight,this.settings.polling),this},a(),t})},{}]},{},[1]);
//# sourceMappingURL=lunicorn-0.2.0.min.js.map